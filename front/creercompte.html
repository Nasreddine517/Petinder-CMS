<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Petinder - Créer un compte</title>
  <link rel="stylesheet" href="creercompte.css"> <!-- CORRIGÉ : bon fichier CSS -->
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="en-tete">
    <div class="gauche">
      <img src="assets/WhatsApp_Image_2025-10-23_à_15.49.28_e46507ee-removebg-preview.png" alt="Petinder">
    </div>

    <nav class="milieu">
      <a href="index.html">Accueil</a>
      <a href="profiles.html">Tous les Profiles</a>
      <a href="formule.html">Formules</a>
      <a href="qui.html">Qui-sommes-nous ?</a>
      <a href="actu.html">Actu</a>
      <a href="contact.html">Contact</a>
    </nav>

    <div class="droite">
      <a href="seconecter.html" class="btn1">Se connecter</a>
    </div>
  </div>
</div>

<!-- HERO -->
<div class="about-hero">
  <div class="content">
    <p class="breadcrumb"><a href="index.html">Home</a> / Créer un compte</p>
    <h1>Créer un compte</h1>
  </div>
</div>

<div class="page-blanche"></div>

<!-- FORMULAIRE D'INSCRIPTION -->
<div class="login-container">
  <div class="form-section">
    <h1>Je crée mon compte</h1>
    
    <form id="registerForm">
      <!-- Nom complet -->
      <div class="input-group">
        <p>Nom complet <span>*</span></p>
        <input type="text" id="fullName" name="fullName" placeholder="Votre nom et prénom" required>
      </div>

      <!-- Email -->
      <div class="input-group">
        <p>Adresse email <span>*</span></p>
        <input type="email" id="registerEmail" name="email" placeholder="Votre email" required>
      </div>

      <!-- Mot de passe -->
      <div class="input-group">
        <p>Mot de passe <span>*</span></p>
        <input type="password" id="registerPassword" name="password" placeholder="Créez un mot de passe" required>
        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
          Minimum 6 caractères
        </small>
      </div>

      <!-- Confirmation mot de passe -->
      <div class="input-group">
        <p>Confirmer le mot de passe <span>*</span></p>
        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Retapez votre mot de passe" required>
      </div>

      <!-- Conditions -->
      <div class="input-group" style="margin-top: 20px;">
        <label style="display: flex; align-items: flex-start; font-size: 14px; color: #555;">
          <input type="checkbox" id="acceptTerms" required style="margin-right: 10px; margin-top: 3px;">
          <span>J'accepte les <a href="#" style="color: #ff4f8b;">conditions générales</a> et la <a href="#" style="color: #ff4f8b;">politique de confidentialité</a> de Petinder</span>
        </label>
      </div>

      <!-- Message d'erreur/succès -->
      <div id="registerMessage" class="message" style="display: none;"></div>

      <!-- Boutons -->
      <div class="buttons">
        <a href="mercipourlinscription.html" class="btn-secondary">Creer mon compte</a>

        <div class="separator">
          <span></span>
          <p>OU</p>
          <span></span>
        </div>

        <a href="seconnecter.html" class="btn-secondary">J'ai déjà un compte</a>
      </div>
    </form>
  </div>

  <div class="image-section">
    <img src="assets/image.png" alt="Création de compte Petinder">
  </div>
</div>

<!-- FOOTER -->
<footer class="footer">
  <div class="footer-container">
    
    <div class="footer-about">
      <a href="index.html">
        <img src="assets/WhatsApp_Image_2025-10-23_à_15.49.28_e46507ee-removebg-preview.png" alt="Dates For Pets" class="footer-logo">
      </a>
      <h3>A propos de Petinder</h3>
      <p>
        Petinder est un site de rencontre pour animaux de compagnie permettant de mettre en relation des particuliers et des éleveurs
        en vue de faire se reproduire leur compagnon afin d'avoir une portée. Il a pour but de simplifier vos recherches et ainsi vous
        proposer des canidés et félidés de race pour des rencontres de qualité au plus près de chez vous.
      </p>
    </div>

    <div class="footer-links">
      <div class="links-col">
        <a href="profils.html">Profils</a>
        <a href="formule.html">Formules</a>
        <a href="quisommesnous.html">Qui sommes-nous ?</a>
        <a href="actualites.html">Actu</a>
        <a href="contact.html">Contact</a>
      </div>
      <div class="links-col">
        <a href="cgv.html">CGV</a>
        <a href="mentions-legales.html">Mentions légales</a>
        <a href="cookies.html">Utilisation des cookies</a>
      </div>
    </div>

    <div class="footer-social">
      <h3>Suivez-nous</h3>
      <div class="social-icons">
        <a href="#"><img src="assets/Capture d'écran 2025-10-25 145826.png" alt="Instagram"></a>
        <a href="#"><img src="assets/Capture d'écran 2025-10-25 150041.png" alt="Facebook"></a>
      </div>
    </div>
  </div>

  <hr>
  <p class="footer-bottom">© 2025 Petinder- Tous droits réservés</p>
</footer>

<!-- SCRIPT EXTERNE POUR L'INSCRIPTION -->
<script src="auth-check.js"></script>

<!-- SCRIPT D'INSCRIPTION -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.getElementById('registerForm');
    const messageDiv = document.getElementById('registerMessage');

    // Vérifier si déjà connecté
    const token = localStorage.getItem('auth_token');
    if (token) {
      fetch('http://localhost:5000/api/auth/check', {
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(response => {
        if (response.ok) {
          window.location.href = 'accueilconnected.html';
        }
      })
      .catch(() => {
        localStorage.removeItem('auth_token');
      });
    }

    // Gestion de la soumission du formulaire d'inscription
    registerForm.addEventListener('submit', async function(e) {
      e.preventDefault();

      // Récupérer les valeurs
      const fullName = document.getElementById('fullName').value.trim();
      const email = document.getElementById('registerEmail').value.trim();
      const password = document.getElementById('registerPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const acceptTerms = document.getElementById('acceptTerms').checked;

      // Validation côté client
      if (!fullName || !email || !password || !confirmPassword) {
        showMessage('Veuillez remplir tous les champs obligatoires', 'error');
        return;
      }

      // Vérifier la longueur du nom
      if (fullName.length < 2) {
        showMessage('Le nom doit contenir au moins 2 caractères', 'error');
        return;
      }

      // Validation format email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        showMessage('Format d\'email invalide', 'error');
        return;
      }

      // Vérifier la longueur du mot de passe
      if (password.length < 6) {
        showMessage('Le mot de passe doit contenir au moins 6 caractères', 'error');
        return;
      }

      // Vérifier si les mots de passe correspondent
      if (password !== confirmPassword) {
        showMessage('Les mots de passe ne correspondent pas', 'error');
        return;
      }

      // Vérifier l'acceptation des conditions
      if (!acceptTerms) {
        showMessage('Vous devez accepter les conditions générales', 'error');
        return;
      }

      // Désactiver le bouton pendant le traitement
      const submitBtn = registerForm.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Création en cours...';
      submitBtn.disabled = true;

      try {
        // Envoyer au backend
        const response = await fetch('http://localhost:5000/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            name: fullName,
            email: email,
            password: password
          })
        });

        const data = await response.json();

        if (response.ok) {
          // SUCCÈS
          showMessage('Compte créé avec succès ! Redirection...', 'success');

          // Sauvegarder dans localStorage
          localStorage.setItem('auth_token', data.token);
          localStorage.setItem('user_email', data.user.email);
          localStorage.setItem('user_name', data.user.name);
          localStorage.setItem('user_id', data.user._id);

          // Rediriger après 1.5 secondes vers la page de connexion ou accueil
          setTimeout(() => {
            window.location.href = 'accueilconnected.html';
          }, 1500);

        } else {
          // ÉCHEC
          let errorMessage = data.message || 'Erreur lors de la création du compte';

          // Messages d'erreur personnalisés
          if (response.status === 409) {
            errorMessage = 'Cet email est déjà utilisé. Veuillez vous connecter ou utiliser un autre email.';
          } else if (response.status === 400) {
            errorMessage = data.message || 'Données invalides. Veuillez vérifier vos informations.';
          }

          showMessage(errorMessage, 'error');
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        }

      } catch (error) {
        console.error('Erreur:', error);
        showMessage('Erreur de connexion au serveur. Veuillez réessayer.', 'error');
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
      }
    });

    // Fonction pour afficher les messages
    function showMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = 'block';

      // Faire défiler jusqu'au message
      messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Masquer après 7 secondes
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, 7000);
    }
  });
</script>

</body>
</html>