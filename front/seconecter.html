<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Petinder- Se connecter</title>
  <link rel="stylesheet" href="seconecter.css">
</head>
<body>

<!-- HEADER -->
  <div class="header">

    <div class="en-tete">
        <div class="gauche">
            <img src="assets/WhatsApp_Image_2025-10-23_à_15.49.28_e46507ee-removebg-preview.png" alt="">
        </div>

        <nav class="milieu">
            
            <a href="index.html" >Accueil</a>
            
           
            <a href="profiles.html">Tous les Profiles</a>
            
           
            <a href="formule.html">Formules</a>
          
            
            <a href="qui.html">Qui-sommes-nous ?</a>
            
           
            <a href="actu.html">Actu</a>
            <a href="contact.html">Contact</a>
            
        </nav>

        <div class="droite">
            
            <a href="seconecter.html" class="btn1">Se connecter</a>

            
        </div>
    </div>
</div>
  <!-- HERO -->
  <div class="about-hero">
    <div class="content">
      <p class="breadcrumb"><a href="index.html">Home</a> / Se connecter</p>
      <h1>Se connecter</h1>
    </div>
  </div>

  <div class="page-blanche"></div>

  <!-- FORMULAIRE DE CONNEXION -->
  <!-- FORMULAIRE DE CONNEXION -->
<div class="login-container">
  <div class="form-section">
    <h1>J’ai déjà un compte</h1>
    
    <!-- FORMULAIRE MODIFIÉ AVEC ID -->
    <form id="loginForm">
      <div class="input-group">
        <p>Adresse email <span>*</span></p>
        <input type="email" id="email" name="email" placeholder="Votre email" required>
      </div>

      <div class="input-group">
        <p>Mot de passe <span>*</span></p>
        <input type="password" id="password" name="password" placeholder="Entrez votre mot de passe" required>
      </div>

      <div class="forgot-password">
        <a href="#">Mot de passe oublié ?</a>
      </div>

      <!-- MESSAGE D'ERREUR/SUCCÈS -->
      <div id="message" class="message" style="display: none;"></div>

      <div class="buttons">
        <button type="submit"  class="btn-primary">Se connecter</button>

        <div class="separator">
          <span></span>
          <p>OU</p>
          <span></span>
        </div>

        <a href="creercompte.html" class="btn-secondary">Je me crée un compte</a>
      </div>
    </form>
  </div>

  <div class="image-section">
    <img src="assets/image.png" alt="Connexion Dates For Pets">
  </div>
</div>

  <!-- FOOTER -->
  <footer class="footer">
    <div class="footer-container">
      
      <div class="footer-about">
        <a href="index.html">
          <img src="assets/WhatsApp_Image_2025-10-23_à_15.49.28_e46507ee-removebg-preview.png" alt="Dates For Pets" class="footer-logo">
        </a>
        <h3>A propos de Petinder</h3>
        <p>
          Petinder est un site de rencontre pour animaux de compagnie permettant de mettre en relation des particuliers et des éleveurs
          en vue de faire se reproduire leur compagnon afin d’avoir une portée. Il a pour but de simplifier vos recherches et ainsi vous
          proposer des canidés et félidés de race pour des rencontres de qualité au plus près de chez vous.
        </p>
      </div>

      <div class="footer-links">
        <div class="links-col">
          <a href="profils.html">Profils</a>
          <a href="formule.html">Formules</a>
          <a href="quisommesnous.html">Qui sommes-nous ?</a>
          <a href="actualites.html">Actu</a>
          <a href="contact.html">Contact</a>
        </div>
        <div class="links-col">
          <a href="cgv.html">CGV</a>
          <a href="mentions-legales.html">Mentions légales</a>
          <a href="cookies.html">Utilisation des cookies</a>
        </div>
      </div>

      <div class="footer-social">
        <h3>Suivez-nous</h3>
        <div class="social-icons">
          <a href="#"><img src="assets/Capture d'écran 2025-10-25 145826.png" alt="Instagram"></a>
          <a href="#"><img src="assets/Capture d'écran 2025-10-25 150041.png" alt="Facebook"></a>
        </div>
      </div>
    </div>

    <hr>
    <p class="footer-bottom">© 2025 Petinder- Tous droits réservés</p>
  </footer>

  <!-- SCRIPT DE CONNEXION -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const loginForm = document.getElementById('loginForm');
    const messageDiv = document.getElementById('message');
    const submitBtn = loginForm.querySelector('button[type="submit"]');
    const originalButtonText = 'Se connecter';

    // S'assurer que le bouton est dans l'état initial au chargement de la page
    resetButton();

    // Vérifier si déjà connecté
    const token = localStorage.getItem('auth_token');
    if (token) {
      // Vérifier si le token est valide
      fetch('http://localhost:5000/api/auth/check', {
        headers: { 'Authorization': `Bearer ${token}` }
      })
      .then(response => {
        if (response.ok) {
          // Rediriger vers la page connectée
          window.location.href = 'accueilconnected.html';
        } else {
          // Token invalide, nettoyer localStorage
          localStorage.removeItem('auth_token');
          localStorage.removeItem('user_email');
          localStorage.removeItem('user_name');
          localStorage.removeItem('user_id');
        }
      })
      .catch(() => {
        // Token invalide, on reste sur la page de connexion
        localStorage.removeItem('auth_token');
        localStorage.removeItem('user_email');
        localStorage.removeItem('user_name');
        localStorage.removeItem('user_id');
      });
    }

    // Gestion de la soumission du formulaire
    loginForm.addEventListener('submit', async function(e) {
      e.preventDefault();

      // Récupérer les valeurs
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      // Validation
      if (!email || !password) {
        showMessage('Veuillez remplir tous les champs', 'error');
        return;
      }

      // Désactiver le bouton
      submitBtn.textContent = 'Connexion en cours...';
      submitBtn.disabled = true;

      try {
        // Envoyer au backend
        const response = await fetch('http://localhost:5000/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });

        const data = await response.json();

        if (response.ok) {
          // SUCCÈS
          showMessage('Connexion réussie ! Redirection...', 'success');

          // Sauvegarder dans localStorage
          localStorage.setItem('auth_token', data.token);
          localStorage.setItem('user_email', data.user.email);
          localStorage.setItem('user_name', data.user.name);
          localStorage.setItem('user_id', data.user._id);

          // Rediriger après 1.5 secondes
          setTimeout(() => {
            window.location.href = 'accueilconnected.html';
          }, 1500);

        } else {
          // ÉCHEC
          showMessage(data.message || 'Email ou mot de passe incorrect', 'error');
          resetButton();
        }

      } catch (error) {
        console.error('Erreur:', error);
        showMessage('Erreur de connexion au serveur. Vérifiez que le backend est démarré.', 'error');
        resetButton();
      }
    });

    // Fonction pour réinitialiser le bouton
    function resetButton() {
      submitBtn.textContent = originalButtonText;
      submitBtn.disabled = false;
    }

    // Fonction pour afficher les messages
    function showMessage(text, type) {
      messageDiv.textContent = text;
      messageDiv.className = `message ${type}`;
      messageDiv.style.display = 'block';

      // Faire défiler jusqu'au message
      messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });

      // Masquer après 5 secondes pour les erreurs, 3 secondes pour les succès
      const timeout = type === 'success' ? 3000 : 5000;
      setTimeout(() => {
        messageDiv.style.display = 'none';
      }, timeout);
    }
  });
</script>

<script src="auth-check.js"></script>
</body>
</html>